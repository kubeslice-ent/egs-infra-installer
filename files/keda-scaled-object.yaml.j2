apiVersion: keda.sh/v1alpha1
kind: ScaledObject
metadata:
  name: {{ keda_scaled_object_name | default('llm-demo-keda') }}
  namespace: {{ keda_scaled_object_namespace | default('nim') }}
{% if keda_scaled_object_labels is defined %}
  labels:
{% for key, value in keda_scaled_object_labels.items() %}
    {{ key }}: "{{ value }}"
{% endfor %}
{% endif %}
spec:
  scaleTargetRef:
    name: {{ keda_scaled_object_target_name | default('meta-llama3-8b-instruct') }}
  pollingInterval: {{ keda_scaled_object_polling_interval | default(30) }}
  minReplicaCount: {{ keda_scaled_object_min_replicas | default(1) }}
  maxReplicaCount: {{ keda_scaled_object_max_replicas | default(8) }}
  triggers:
    - type: prometheus
      metadata:
        serverAddress: {{ keda_scaled_object_prometheus_address | default('http://prometheus-kube-prometheus-prometheus.monitoring.svc.cluster.local:9090') }}
        metricName: {{ keda_scaled_object_metric_name | default('smartscaler_hpa_num_pods') }}
        threshold: '{{ keda_scaled_object_threshold | default("1") }}'
        query: {{ keda_scaled_object_query | default('smartscaler_hpa_num_pods{job="pushgateway", kubernetes_pod_name="meta-llama3-8b-instruct->nim->nim-llama", ss_deployment_name="meta-llama3-8b-instruct"}') }} 